# Use the correct and supported miniforge3 image
FROM condaforge/miniforge3:latest

# Set noninteractive to avoid prompts
ENV DEBIAN_FRONTEND=noninteractive

# Install essential OS packages and fonts
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    build-essential \
    curl \
    wget \
    unzip \
    jq \
    htop \
    locales \
    git \
    tmux \
    zstd \
    neovim \
    sudo \
    && rm -rf /var/lib/apt/lists/*

# Set locale
RUN locale-gen en_US.UTF-8
ENV LANG=en_US.UTF-8
ENV LC_ALL=en_US.UTF-8

# Create the vscode user and switch to it
RUN groupadd --gid 1000 vscode && \
    useradd -s /bin/bash --uid 1000 -g vscode -m vscode && \
    usermod -a -G sudo vscode

# Set work directory and give ownership to the vscode user
WORKDIR /workspace
RUN chown -R vscode:vscode /workspace

# Set default user for subsequent commands
USER vscode

# Make scripts executable
RUN chmod +x .devcontainer/scripts/*.sh || true
