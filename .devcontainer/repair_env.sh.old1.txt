#!/bin/bash
echo "Repairing environment..."

# Poetry
if ! command -v poetry >/dev/null 2>&1; then
    echo "Installing Poetry..."
    curl -sSL https://install.python-poetry.org | python3 -
fi

# Node
if ! command -v node >/dev/null 2>&1; then
    echo "Installing latest Node LTS..."
    curl -fsSL https://deb.nodesource.com/setup_lts.x | bash -
    apt-get install -y nodejs
fi

# Julia
if ! command -v julia >/dev/null 2>&1; then
    echo "Installing latest Julia..."
    JULIA_URL=$(curl -s https://api.github.com/repos/JuliaLang/julia/releases/latest \
      | grep browser_download_url | grep "linux-x86_64.tar.gz" | cut -d '"' -f 4)
    wget $JULIA_URL -O julia.tar.gz
    tar -xvzf julia.tar.gz -C /opt/
    JULIA_DIR=$(tar -tf julia.tar.gz | head -1 | cut -f1 -d"/")
    ln -s /opt/$JULIA_DIR/bin/julia /usr/local/bin/julia
    rm julia.tar.gz
fi

# SQLite
if ! command -v sqlite3 >/dev/null 2>&1; then
    apt-get update && apt-get install -y sqlite3
fi

echo "Environment repair complete!"
